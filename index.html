<!DOCTYPE html>
<html lang="ko">
<head>
    <link rel="shortcut icon" href="favicon.ico" type="image/x-icon">
    <link rel="icon" href="favicon.ico" type="image/x-icon">
    
    <link rel="manifest" href="site.webmanifest">
    
    <link rel="apple-touch-icon" href="favicon.ico">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>로그인 | Beyond The Line Math</title>
    
    <link rel="shortcut icon" href="favicon.ico" type="image/x-icon">
    <link rel="icon" href="favicon.ico" type="image/x-icon">
    <link rel="manifest" href="site.webmanifest">
    <link rel="apple-touch-icon" href="favicon.ico">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@800;900&family=Pretendard:wght@300;400;600;800&display=swap" rel="stylesheet">
    
    <style>
        body {
            font-family: 'Pretendard', sans-serif;
            background-color: #ffffff;
            color: #1e293b;
            display: flex;
            align-items: center;
            justify-content: center;
            height: 100vh;
            margin: 0;
        }

        .brand-title {
            font-family: 'Montserrat', sans-serif;
            letter-spacing: -0.05em;
            background: linear-gradient(135deg, #0f172a 0%, #334155 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .login-card {
            width: 100%;
            max-width: 400px;
            padding: 40px;
        }

        input {
            transition: all 0.2s;
        }

        input:focus {
            border-color: #0f172a;
            box-shadow: 0 0 0 4px rgba(15, 23, 42, 0.1);
        }

        .login-btn {
            background-color: #0f172a;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .login-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px -10px rgba(15, 23, 42, 0.5);
            background-color: #1e293b;
        }

        .login-btn:active {
            transform: translateY(0);
        }
    </style>
</head>
<body>

    <script src="config.js"></script>

    <div class="login-card animate-[fadeIn_0.6s_ease-out]">
        <div class="text-center mb-10">
            <h1 class="brand-title text-4xl font-black mb-2">BEYOND THE LINE</h1>
            <p class="text-slate-400 font-medium text-sm tracking-tight">AI Powered Mathematics Solution</p>
        </div>

        <form id="login-form" onsubmit="handleLogin(event)" class="space-y-6">
            <div class="space-y-1.5">
                <label for="username" class="text-[11px] font-extrabold text-slate-500 uppercase tracking-widest ml-1">Identity</label>
                <input type="text" id="username" required 
                    class="w-full px-5 py-4 bg-slate-50 border-2 border-slate-100 rounded-2xl text-sm font-semibold outline-none"
                    placeholder="아이디를 입력하세요">
            </div>

            <div class="space-y-1.5">
                <label for="password" class="text-[11px] font-extrabold text-slate-500 uppercase tracking-widest ml-1">Access Code</label>
                <input type="password" id="password" required 
                    class="w-full px-5 py-4 bg-slate-50 border-2 border-slate-100 rounded-2xl text-sm font-semibold outline-none"
                    placeholder="비밀번호를 입력하세요">
            </div>

            <button type="submit" id="submit-btn" 
                class="login-btn w-full py-5 text-white font-black rounded-2xl text-sm shadow-xl mt-4 flex items-center justify-center">
                접속하기
            </button>
        </form>

        <p class="text-center mt-10 text-[10px] text-slate-400 font-bold uppercase tracking-widest">
            &copy; 2024 Beyond The Line. All rights reserved.
        </p>
    </div>

    <script>
        async function handleLogin(e) {
            e.preventDefault();
            const btn = document.getElementById('submit-btn');
            const originalBtnContent = btn.innerHTML;
            
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;

            btn.disabled = true;
            btn.classList.add('opacity-80', 'cursor-not-allowed');
            btn.innerHTML = '<i class="fa-solid fa-circle-notch fa-spin"></i>';

            try {
                const { data, error } = await _supabase
                    .from('users')
                    .select('*')
                    .eq('username', username)
                    .eq('password', password)
                    .single();

                if (error || !data) throw new Error('Invalid credentials');

                sessionStorage.setItem('currentUser', JSON.stringify(data));
                
                btn.style.backgroundColor = "#10b981"; 
                btn.innerHTML = '<i class="fa-solid fa-check mx-auto"></i>';
                
                setTimeout(() => {
                    if (data.role === 'admin' || data.role === 'teacher') {
                        location.href = 'teacher_main.html';
                    } else {
                        location.href = 'student_main.html';
                    }
                }, 600);

            } catch (err) {
                btn.style.backgroundColor = "#ef4444";
                btn.innerHTML = '로그인 실패';
                
                const form = document.getElementById('login-form');
                form.animate([
                    { transform: 'translateX(0)' },
                    { transform: 'translateX(-5px)' },
                    { transform: 'translateX(5px)' },
                    { transform: 'translateX(0)' }
                ], { duration: 300 });

                setTimeout(() => {
                    btn.style.backgroundColor = ""; 
                    btn.innerHTML = originalBtnContent;
                    btn.classList.remove('opacity-80', 'cursor-not-allowed');
                    btn.disabled = false;
                    document.getElementById('password').value = '';
                    document.getElementById('password').focus();
                }, 1000);
            }
        }
    </script>
</body>
</html>