<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>시험지 생성 공장 - 출제 전용 시스템</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <script src="config.js"></script>

    <style>
        /* [한글 최적화] 수학과 사장님을 위한 직관적인 스타일링 */
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;700;900&display=swap');
        
        body { 
            font-family: 'Noto Sans KR', sans-serif; 
            background-color: #020617; 
            color: #e2e8f0; 
            height: 100vh; 
            overflow: hidden; 
            display: flex;
            padding: 24px;
            gap: 24px;
        }

        /* 유리창 스타일 패널 */
        .glass-panel { 
            background: rgba(15, 23, 42, 0.9); 
            backdrop-filter: blur(16px); 
            border: 1px solid rgba(255,255,255,0.05); 
            border-radius: 20px; 
            box-shadow: 0 15px 35px -10px rgba(0,0,0,0.6);
            display: flex; 
            flex-direction: column;
            overflow: hidden;
        }

        .pro-scroll::-webkit-scrollbar { width: 4px; }
        .pro-scroll::-webkit-scrollbar-thumb { background: #334155; border-radius: 10px; }
        .pro-scroll::-webkit-scrollbar-track { background: transparent; }

        .pro-input {
            background: #1e293b; border: 1px solid #334155; color: white;
            border-radius: 12px; padding: 14px; font-size: 0.9rem; outline: none; width: 100%;
            transition: 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .pro-input:focus { border-color: #6366f1; box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.15); }

        /* 사이드바 항목 */
        .list-item {
            padding: 14px; border-radius: 14px; cursor: pointer; transition: 0.2s;
            border: 1px solid transparent; margin-bottom: 8px; background: rgba(255,255,255,0.02);
        }
        .list-item:hover { background: rgba(99, 102, 241, 0.08); border-color: rgba(99, 102, 241, 0.2); }
        .list-item.selected { background: rgba(79, 70, 229, 0.15); border-color: #4f46e5; }
    </style>
</head>
<body>

    <aside class="w-80 glass-panel p-6 shrink-0">
        <header class="mb-8">
            <h2 class="text-[10px] font-black text-indigo-400 uppercase tracking-[0.2em] mb-4">I. 환경 설정</h2>
            <select id="sel-platform" onchange="FactoryShell.onCategoryChange(this.value)" class="pro-input text-xs font-bold">
                <option value="">카테고리를 선택하세요...</option>
            </select>
        </header>

        <section class="flex-1 flex flex-col min-h-0">
            <h2 class="text-[10px] font-black text-slate-500 uppercase tracking-widest mb-4 px-1">II. 마스터 자산 리스트</h2>
            <div id="list-container" class="flex-1 pro-scroll overflow-y-auto pr-2">
                <div class="text-center py-24 opacity-20 pointer-events-none">
                    <i class="fa-solid fa-folder-tree text-3xl mb-4"></i>
                    <p class="text-[10px] font-bold tracking-widest uppercase">카테고리를 선택하면<br>자산 목록이 나타납니다</p>
                </div>
            </div>
        </section>
    </aside>

    <main class="flex-1 glass-panel p-8 relative">
        <header id="engine-header" class="mb-8 min-h-[60px]"></header>

        <section id="engine-main" class="flex-1 min-h-0">
            <div class="h-full flex flex-col items-center justify-center opacity-10 grayscale pointer-events-none">
                <i class="fa-solid fa-wand-magic-sparkles text-8xl mb-6"></i>
                <p class="text-sm font-black tracking-[0.4em] uppercase">작업 엔진 대기 중</p>
            </div>
        </section>

        <footer id="engine-footer" class="mt-8 pt-6 border-t border-slate-800"></footer>
    </main>

    <script>
        /**
         * @object FactoryShell
         * @description 출제 전용 엔진 오케스트레이터 (관리는 타 시스템에서 수행)
         */
        const FactoryShell = {
            state: { categories: [], currentCat: null },

            async init() {
                try {
                    const { data, error } = await _supabase.from('test_category').select('*').order('name');
                    if (error) throw error;
                    this.state.categories = data || [];
                    const sel = document.getElementById('sel-platform');
                    sel.innerHTML = '<option value="">카테고리를 선택하세요...</option>' + 
                        this.state.categories.map(c => `<option value="${c.test_id}">${c.name}</option>`).join('');
                } catch (e) {
                    console.error("[시스템] 초기화 오류:", e.message);
                }
            },

            onCategoryChange(catId) {
                this.state.currentCat = this.state.categories.find(c => c.test_id == catId);
                if (this.state.currentCat) this.mountEngine();
            },

            mountEngine() {
                // 내부/외부 여부에 따른 파일명 결정 (무조건 maker 엔진만 로드)
                const isInternal = this.state.currentCat.is_internal;
                const engineName = `${isInternal ? 'Int' : 'Ext'}Maker`;
                const fileName = `engine_${isInternal ? 'int' : 'ext'}_maker.js`;

                // 기존 런타임 제거
                const oldScript = document.getElementById('engine-runtime');
                if (oldScript) oldScript.remove();

                // UI 초기화
                document.getElementById('engine-header').innerHTML = '';
                document.getElementById('engine-main').innerHTML = '<div class="flex h-full items-center justify-center opacity-30"><i class="fa-solid fa-circle-notch fa-spin text-4xl"></i></div>';
                document.getElementById('engine-footer').innerHTML = '';

                // 스크립트 로드
                const script = document.createElement('script');
                script.id = 'engine-runtime';
                script.src = `./test_paper_maker/${fileName}?v=${Date.now()}`;
                script.onload = () => {
                    if (window[engineName]) {
                        window[engineName].mount(this.state.currentCat);
                    }
                };
                document.head.appendChild(script);
            }
        };

        document.addEventListener('DOMContentLoaded', () => FactoryShell.init());
    </script>
</body>
</html>